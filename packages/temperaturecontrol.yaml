homeassistant:
  customize:
    # Add state-class to enable long term statistics:
    sensor.pricelevel:
      state_class: measurement
    sensor.spotpris_average_today:
      state_class: measurement

# Temperature Control Template Sensors and Binary Sensors
# Migrated from legacy platform: template format

template:
  - sensor:
      - name: "pricelevel"
        unique_id: pricelevel_sensor
        state: "{{ state_attr('sensor.electricity_price_sivert_thonstads_vei_6b', 'price_level') | default('unknown') }}"

      - name: "today_max_price"
        unique_id: today_max_price_sensor
        state: >-
          {% set today = state_attr('sensor.nordpool', 'raw_today') | default([]) | sort(attribute='value') %}
          {% if today | length > 0 %}
            {{ (today[-1].value * 100) | round(2) }}
          {% else %}
            0
          {% endif %}

      - name: "tomorrow_max_price"
        unique_id: tomorrow_max_price_sensor
        state: >-
          {% set tomorrow = state_attr('sensor.nordpool', 'raw_tomorrow') | default([]) | sort(attribute='value') %}
          {% if tomorrow | length > 0 %}
            {{ (tomorrow[-1].value * 100) | round(2) }}
          {% else %}
            0
          {% endif %}

      - name: "tomorrow_low_price"
        unique_id: tomorrow_low_price_sensor
        state: >-
          {% set tomorrow = state_attr('sensor.nordpool', 'raw_tomorrow') | default([]) | sort(attribute='value') %}
          {% if tomorrow | length > 0 %}
            {{ (tomorrow[0].value * 100) | round(2) }}
          {% else %}
            0
          {% endif %}

      - name: "today_low_price"
        unique_id: today_low_price_sensor
        state: >-
          {% set today = state_attr('sensor.nordpool', 'raw_today') | default([]) | sort(attribute='value') %}
          {% if today | length > 0 %}
            {{ (today[0].value * 100) | round(2) }}
          {% else %}
            0
          {% endif %}

      - name: "price_difference_tomorrow"
        unique_id: price_difference_tomorrow_sensor
        state: >-
          {% set today = state_attr('sensor.nordpool', 'raw_today') | default([]) | sort(attribute='value') %}
          {% set tomorrow = state_attr('sensor.nordpool', 'raw_tomorrow') | default([]) | sort(attribute='value') %}
          {% if today | length > 0 and tomorrow | length > 0 %}
            {{ ((tomorrow[0].value - today[0].value) * 100) | round(2) }}
          {% else %}
            0
          {% endif %}

      - name: "price_difference_nights"
        unique_id: price_difference_nights_sensor
        state: >-
          {% set today = states('sensor.billigste_pris_ikveld') | float(0) %}
          {% set tomorrow = states('sensor.billigste_pris_imorgen_ettermiddag') | float(0) %}
          {{ ((tomorrow - today) * 100) | round(2) }}

      - name: "rest_of_today_low_price"
        unique_id: rest_of_today_low_price_sensor
        state: >-
          {% set today = state_attr('sensor.nordpool', 'raw_today') | default([]) %}
          {% set now_hour = now().hour %}
          {% set future_hours = today | selectattr('start', 'ge', now()) | list %}
          {% if future_hours | length > 0 %}
            {% set sorted_future = future_hours | sort(attribute='value') %}
            {{ (sorted_future[0].value * 100) | round(2) }}
          {% else %}
            0
          {% endif %}

      - name: "billigste_pris_ikveld"
        unique_id: billigste_pris_ikveld_sensor
        state: >-
          {%-set nowTime = now().hour | float(default=0)-%}
          {% set tonight = namespace(values=[]) %}
          {% set today=state_attr('sensor.nordpool', 'raw_today') %}
          {% for hour in today %}
              {% if hour.start.hour >= nowTime %}
              {% set tonight.values = tonight.values + [{'start':hour.start,'end':hour.end,'value': hour.value}] %}
              {% endif %}
          {%- endfor -%}
          {% set tonight_min = tonight.values |sort(attribute='value') %}
          {% set cheapest = tonight_min[0] or None %}
          {{cheapest.value or 0}}

      - name: "billigste_pris_imorgen_ettermiddag"
        unique_id: billigste_pris_imorgen_ettermiddag_sensor
        state: >-
          {% if states.sensor.nordpool.attributes.tomorrow_valid  %}
            {% set tomorrow=state_attr('sensor.nordpool', 'raw_tomorrow') %}
            {% set tomorrow_night = namespace(values=[]) %}
            {% for hour in tomorrow %}
              {% if hour.start.hour > 16 %}
                  {% set tomorrow_night.values = tomorrow_night.values + [{'start':hour.start,'end':hour.end,'value': hour.value}] %}
              {% endif %}
            {%- endfor -%}
            {% set tomorrow_min = tomorrow_night.values |sort(attribute='value') %}
            {% set cheapest = tomorrow_min[0] or None %}
          {{cheapest.value or 0}}  
          {% endif %}

      - name: "billigste_time"
        unique_id: billigste_time_sensor
        state: >-
          {%-set nowTime = now().hour | float(default=0)-%}
          {% set tonight = namespace(values=[]) %}
          {% set today=state_attr('sensor.nordpool', 'raw_today') %}
          {% for hour in today %}
              {% if hour.start.hour >= nowTime %}
              {% set tonight.values = tonight.values + [{'start':hour.start,'end':hour.end,'value': hour.value}] %}
              {% endif %}
          {%- endfor -%}
          {% set tonight_min = tonight.values |sort(attribute='value') %}
          {% set cheapest = tonight_min[0] %}
          {% if states.sensor.nordpool.attributes.tomorrow_valid  %}
            {% set tomorrow=state_attr('sensor.nordpool', 'raw_tomorrow') %}
            {% set tomorrow_night = namespace(values=[]) %}
            {% for hour in tomorrow %}
                  {% set tomorrow_night.values = tomorrow_night.values + [{'start':hour.start,'end':hour.end,'value': hour.value}] %}
            {%- endfor -%}
            {% set tomorrow_min = tomorrow_night.values |sort(attribute='value') %}
            {% set cheapest = tomorrow_min[0] %}
          {% else %}
            {% set cheapest = tomorrow_min[0] %}
          {% endif %}
          {{cheapest.start}}

      - name: "pricespike"
        unique_id: pricespike_sensor
        state: >-
          {%-set nordpool = states.sensor.nordpool -%}
          {{nordpool.attributes.max / nordpool.attributes.min - 1 | round(2)}}

      - name: "spotpris_today"
        unique_id: spotpris_today_sensor
        icon: "mdi:cash-multiple"
        unit_of_measurement: "NOK"
        state: >-
          {{
            ((states('sensor.accumulated_consumption_sivert_thonstads_vei_6b')| float(default=0))
            *(state_attr('sensor.nordpool', 'average')| float(default=0)))
            |round(2)
          }}

      - name: "spotpris_average_today"
        unique_id: spotpris_average_today_sensor
        icon: "mdi:cash-multiple"
        unit_of_measurement: "NOK"
        state: >-
          {{state_attr('sensor.nordpool', 'average') | float(default=0)|round(2)}}

      - name: "fastpris_today"
        unique_id: fastpris_today_sensor
        icon: "mdi:cash-multiple"
        unit_of_measurement: "NOK"
        state: >-
          {{
            ((states('sensor.accumulated_consumption_sivert_thonstads_vei_6b')| float(default=0))
            *(states('sensor.powerprice')| float(default=0)))
            |round(2)
          }}

      - name: "total_powerprice"
        unique_id: total_powerprice_sensor
        unit_of_measurement: NOK
        state: >-
          {%set gridprice = states.sensor.gridprice.state | float(default=0)%}
          {%set powerprice = states.sensor.powerprice.state | float(default=0)%}
          {{powerprice + gridprice}}

      - name: "powerprice"
        unique_id: powerprice_sensor
        unit_of_measurement: NOK/kWh
        state: >-
          {{0.54}}

      - name: "gridprice"
        unique_id: gridprice_sensor
        unit_of_measurement: NOK
        state: >-
          {% set hour = now().hour %}
          {% set day = now().day %}
          {% set month = now().month %}
          {% set pricePerKwh = 0.396125 %}
          {% if hour >= 22 or hour <= 5%}
            {% set pricePerKwh = 0.283625 %}
          {% endif %}
          {{pricePerKwh}}

      - name: "refheat"
        unique_id: refheat_sensor
        unit_of_measurement: "°C"
        state: >-
          {%-set alarm = states.input_select.alarm.state -%}
          {%-set hjemmeTemp = states.input_number.hjemmetemp.state | float(default=0)%}
          {%-set borteTemp = states.input_number.bortetemp.state | float(default=0)%}
          {%-set nattaTemp = states.input_number.nattatemp.state | float(default=0)%}
          {% if alarm == 'Disarm' %}
            {%-set temp = hjemmeTemp -%}   
          {% elif alarm == 'Arm Home'%}
              {%-set temp = nattaTemp -%} 
          {% else %}
            {%-set temp = borteTemp -%} 
          {% endif %}        
          {{temp}}

      - name: "pricecorrection"
        unique_id: pricecorrection_sensor
        unit_of_measurement: "°C"
        attributes:
          source: "{{ states.sensor.priceanalyzer.state }}"
        state: >-
          {%set analyzer = states.sensor.priceanalyzer%}
          {%set current_hour = analyzer.attributes.current_hour%}
          {%set temp = analyzer.state | float %}
          {%set outside_temp = states.sensor.ute_temperature.state | float(default=10)%}
          {%-set alarm = states.input_select.alarm.state -%}
          {%set effektledd = states('input_number.effektledd') | float(default=9.8) %}
          {%set is_charging = states('sensor.garage_power') | int(default=0) > 1%}
          {%if temp > 0 and outside_temp > 5%}
            {%if current_hour.price_next_hour > 2.00 or current_hour.value > 2.00%} {%set temp = temp * 2%} 
            {%elif current_hour.price_next_hour > 1.00 or current_hour.value > 1.00%} {%set temp = temp * 1%} 
            {%elif current_hour.is_max%} {%set temp = temp * 1%}
            {%else%} {%set temp = temp%}
            {%endif%}
          {%else%}
            {%if current_hour.price_next_hour > 6.00 or current_hour.value > 6.00%} {%set temp = temp * 4%} 
            {%elif current_hour.price_next_hour > 4.00 or current_hour.value > 4.00%} {%set temp = temp * 3%} 
            {%elif current_hour.price_next_hour > 1.00 or current_hour.value > 1.00%} {%set temp = temp * 1%} 
            {%elif current_hour.is_max%} {%set temp = temp * 1%}
            {%else%} {%set temp = temp%}
            {%endif%}
          {%endif%}
          {%if is_charging and effektledd < 10 and alarm == 'Arm Home'%}
            {%set temp = temp - 1 %}
          {%endif%}
          {{temp}}

      - name: "baseheat"
        unique_id: baseheat_sensor
        unit_of_measurement: "°C"
        state: >-
          {%-set alarm = states.input_select.alarm.state -%}
          {%-set hjemmeTemp = states.input_number.hjemmetemp.state | float(default=0)%}
          {%-set borteTemp = states.input_number.bortetemp.state | float(default=0)%}
          {%-set nattaTemp = states.input_number.nattatemp.state | float(default=0)%}
          {%-set priceGaining = states.binary_sensor.pricegaining.state == 'on' -%}
          {%-set isHeating = states.input_select.operationmode.state == 'heat' -%}
          {%-set isMaxPrice = states.binary_sensor.ismaxprice.state == 'on' -%}
          {%-set isPeak = states.binary_sensor.pricerelativycheap.state == 'off' -%}
          {%-set minPrice = (states.sensor.nordpool.attributes.min | float) -%}
          {%-set price = states.sensor.nordpool.state | float(default=0)-%}
          {%-set isMinPrice = minPrice == price -%}
          {%-set hour = now().hour | int(default=0)-%}
          {% set startdaywarming = states.input_datetime.nighttemp.state.split(':')[0] | float(default=0)%}
          {% set limit = states.input_boolean.limit_heaters.state == 'on' %}
          {% if alarm == 'Disarm' or (alarm == 'Arm Home' and (hour >= startdaywarming and priceGaining or hour > startdaywarming and hjemmeTemp > borteTemp) and hour < 16) %}
            {%-set temp = hjemmeTemp -%}
          {% elif alarm == 'Arm Home'%}
              {%-set temp = nattaTemp -%} 
          {% else %}
            {%-set temp = borteTemp -%}
          {% endif %}
          {% if temp > 15 %}
            {%-set temp = temp | float(default=0) + states.sensor.pricecorrection.state | float(default=0) -%}                 
          {% endif %}
          {% if limit %}
            {%-set temp = temp - 4 -%}                 
          {% endif %}
          {{temp}}

      - name: "sokkeltemp"
        unique_id: sokkeltemp_sensor
        unit_of_measurement: "°C"
        state: >-
          {%-set baseTemp = states.input_number.sokkeltemp.state | float(default=0)%}
          {%-set priceCorrection = states.sensor.pricecorrection.state | float(default=0)%}
          {%-set temp = baseTemp + priceCorrection -%}
          {% set limit = states.input_boolean.limit_heaters.state == 'on' %}
          {% if limit %}
            {%-set temp = temp - 8 -%}
          {% endif %}
          {{temp}}

      - name: "vindfangtemp"
        unique_id: vindfangtemp_sensor
        unit_of_measurement: "°C"
        state: >-
          {%-set baseTemp = states.input_number.vindfangtemp.state | float(default=0)%}
          {%-set priceCorrection = states.sensor.pricecorrection.state | float(default=0)%}
          {%-set temp = baseTemp + priceCorrection -%}
          {% set limit = states.input_boolean.limit_heaters.state == 'on' %}
          {% if limit %}
            {%-set temp = temp - 8 -%}
          {% endif %}
          {{temp}}

      - name: "bathroomtemp"
        unique_id: bathroomtemp_sensor
        unit_of_measurement: "°C"
        state: >-
          {%-set baseTemp = states.input_number.bathroomtemp.state | float(default=0)%}
          {%-set priceCorrection = states.sensor.pricecorrection.state | float(default=0)%}
          {%-set temp = baseTemp + priceCorrection -%}
          {% set limit = states.input_boolean.limit_heaters.state == 'on' %}
          {% if limit %}
            {%-set temp = temp - 8 -%}                 
          {% endif %}
          {{temp}}

      - name: "toilettemp"
        unique_id: toilettemp_sensor
        unit_of_measurement: "°C"
        state: >-
          {%-set baseTemp =  states.sensor.baseheat.state | float(default=0)%}
          {%-set doorOpen = states.binary_sensor.toilet_door_left_open.state == 'on' -%}
          {%-set temp = baseTemp -%}
          {% if doorOpen %} 
            {%-set temp = 16 -%}
          {% endif %}
          {{temp}}

      - name: "tempsenttoheater"
        unique_id: tempsenttoheater_sensor
        unit_of_measurement: "°C"
        state: >-
          {%-set alarm = states('input_select.alarm') -%}
          {%-set uteTemp = states('sensor.ute_temperature') | float(default=0) or states('sensor.netatmo_home_temperature') | float(default=0) -%}
          {%-set prettyCold = uteTemp < states('input_number.coldthreshold') | float(default=-6) -%}
          {%-set isHeating = states('input_select.operationmode') == 'heat' -%}
          {%-set currentTemp = state_attr('climate.varmepumpe', 'current_temperature') | float(default=20) %}
          {%-set currentTemp = states('sensor.bthome_stua_temperature') | float(default=20) %}
          {%-set priceCorrection = states('sensor.pricecorrection') | float(default=0) %}
          {%-set baseTemp = states('sensor.baseheat') | float(default=0) %}
          {%-set difference = ([baseTemp - currentTemp] | max) | round(1) %}       
          {%-set difference = 0.0 %}       
          {%-set temp = baseTemp -%}
          {% if prettyCold %} 
            {%-set temp = temp + states('input_number.extradegrees') | float(default=0) -%}
          {% endif %}
          {%-set differenceStr = difference | string %}      
          {%-set decimal = differenceStr.split('.')[1] | int(default=0) %}
          {% if decimal < 6 and decimal > 0 and difference < 0.6  %}
            {%-set difference = ([([difference + 0.5, 0.5] | min),0] | max) %}
          {% else %}
            {%-set difference = difference | round() %}
          {% endif %}
          {% if isHeating and baseTemp > 15 and priceCorrection < 3 %} 
            {%-set temp = temp + ([difference, 0] | max) -%}
          {% endif %}
          {% if isHeating == false %} 
            {%-set temp = temp - priceCorrection -%}
          {% endif %}
          {{temp | round() or 22}}

      - name: "fanmode"
        unique_id: fanmode_sensor
        state: >-
          {%-set targetTemp = states.climate.varmepumpe.attributes.temperature | float(default=0)%}
          {%-set currentTemp = states.climate.varmepumpe.attributes.current_temperature | float(default=0)%}
          {%-set operation = states.input_select.operationmode.state -%}
          {% if operation == 'heat' %}
          {%-set difference = targetTemp - currentTemp  %}
          {% else %}
          {%-set difference = ([targetTemp - currentTemp, currentTemp - targetTemp] | max) %}
          {%endif%}
          {% if difference > 4 %}
            high
          {% elif difference > 3 %}
            mediumHigh
          {% elif difference > 2 %}
            mid
          {% elif difference > 1 %}
            auto
          {% else %}
            auto
          {%endif%}

      - name: "priceforgraph"
        unique_id: priceforgraph_sensor
        unit_of_measurement: "W"
        state: "{{states.sensor.nordpool.state | float(default=0)* 10000}}"

      - name: "trymtemp"
        unique_id: trymtemp_sensor
        unit_of_measurement: "C"
        state: >-
          {%-set priceCorrection = states.sensor.priceanalyzer.state | float(default=0) %}
          {%-set hour = now().hour | int(default=0) %}
          {%-set trymasleep = states.input_boolean.trymasleep.state == 'on' -%}
          {%-set trymaway = states.input_boolean.tryminkindergarden.state == 'on' %}
          {%-set away = states.input_select.alarm.state == 'Arm Away' %}
          {%-set windowopen = states.binary_sensor.trym_window.state == 'on' %}
          {%-set bedroomheateron = states.switch.bedroom_heater.state == 'on' %}
          {%-set trymtemp_awake = states.input_number.trym_temp.state | float(default=20) %}
          {%-set sleeptemp = 18 %}
          {% if bedroomheateron %}
            {%-set temp = 4 -%}
          {% elif away or windowopen %}
            {%-set temp = trymtemp_awake - 5 %}
          {% elif trymaway and hour >= 15 %}
            {%-set temp = trymtemp_awake %}
          {% elif trymaway %}
            {%-set temp = 10 %}
          {% elif trymasleep %}
            {%-set temp = sleeptemp %}
          {% else %}
            {%-set temp = trymtemp_awake %}
          {% endif %}
          {% set limit = states.input_boolean.limit_heaters.state == 'on' %}
          {% if limit %}
            {%-set temp = temp - 2 -%}
          {% endif %}
          {{temp + priceCorrection}}

      - name: "tyratemp"
        unique_id: tyratemp_sensor
        unit_of_measurement: "C"
        state: >-
          {%-set priceCorrection = states.sensor.priceanalyzer.state | float(default=0) %}
          {%-set hour = now().hour | int(default=0) %}
          {%-set tyraasleep = states.input_boolean.tyraasleep.state == 'on' -%}
          {%-set tyraaway = states.input_boolean.tyrainkindergarden.state == 'on' %}
          {%-set away = states.input_select.alarm.state == 'Arm Away' %}
          {%-set windowopen = states.binary_sensor.tyra_window.state == 'on' %}
          {%-set bedroomheateron = states.switch.bedroom_heater.state == 'on' %}
          {%-set tyratemp_awake = states.input_number.tyra_temp.state | float(default=20) %}
          {%-set sleeptemp = 18 %}
          {% if bedroomheateron %}
            {%-set temp = 4 -%}
          {% elif away or windowopen %}
            {%-set temp = tyratemp_awake - 5 %}
          {% elif tyraaway and hour >= 15 %}
            {%-set temp = tyratemp_awake %}
          {% elif tyraaway %}
            {%-set temp = 10 %}
          {% elif tyraasleep %}
            {%-set temp = sleeptemp %}
          {% else %}
            {%-set temp = tyratemp_awake %}
          {% endif %}
          {% set limit = states.input_boolean.limit_heaters.state == 'on' %}
          {% if limit %}
            {%-set temp = temp - 2 -%}
          {% endif %}
          {{temp + priceCorrection}}

  - binary_sensor:
      - name: "pricedifferenceissmall"
        unique_id: pricedifferenceissmall_sensor
        state: >-
          {%-set pricedifference = states.sensor.pricespike.state | float(default=0)%}
          {%-set max = states.sensor.priceanalyzer.attributes.max | float(default=0)%}
          {{pricedifference < 0.10 or max < 0.20}}

      - name: "pricecorrection_up"
        unique_id: pricecorrection_up_sensor
        delay_off:
          minutes: 2
        state: >-
          {%-set priceCorrection =  states.sensor.pricecorrection.state | float(default=0) %}
          {{priceCorrection > 0}}

      - name: "pricecorrection_down"
        unique_id: pricecorrection_down_sensor
        delay_off:
          minutes: 2
        state: >-
          {%-set priceCorrection =  states.sensor.pricecorrection.state | float(default=0) %}
          {{priceCorrection < 0}}

      - name: "pricecorrection_down_for_3_hours"
        unique_id: pricecorrection_down_for_3_hours_sensor
        delay_on:
          hours: 4
        delay_off:
          hours: 1
        state: >-
          {%-set priceCorrection =  states.sensor.pricecorrection.state | float(default=0) %}
          {{priceCorrection < 0}}

      - name: "pricecorrection_down_delayed"
        unique_id: pricecorrection_down_delayed_sensor
        delay_off:
          hours: 1
        state: >-
          {%-set priceCorrection =  states.sensor.pricecorrection.state | float(default=0) %}
          {{priceCorrection < 0}}

      - name: "afterpricereduction"
        unique_id: afterpricereduction_sensor
        state: >-
          {%set delayed = states.binary_sensor.pricecorrection_down_delayed.state %}
          {%set down = states.binary_sensor.pricecorrection_down.state %}
          {{delayed == 'on' and down == 'off'}}

      - name: "should_charge_car_tonight"
        unique_id: should_charge_car_tonight_sensor
        state: >-
          {% if states.sensor.nordpool.attributes.tomorrow_valid
              and states.binary_sensor.usingspot.state == 'on'%}
            {% set today=state_attr('sensor.nordpool', 'raw_today') %}
            {% set tomorrow=state_attr('sensor.nordpool', 'raw_tomorrow') %}
            {%-set now = now().hour | float(default=0)-%}
            {% set tonight = namespace(values=[]) %}
            {% set tomorrow_night = namespace(values=[]) %}
            {% for hour in today %}
                {% if hour.start.hour >= now %}
                {% set tonight.values = tonight.values + [{'start':hour.start,'end':hour.end,'value': hour.value}] %}
                {% endif %}
            {%- endfor -%}
            {% for hour in tomorrow %}
                {% if hour.start.hour < 8 %}
                  {% set tonight.values = tonight.values + [{'start':hour.start,'end':hour.end,'value': hour.value}] %}
                {% endif %}
                {% if hour.start.hour > 8 %}
                  {% set tomorrow_night.values = tomorrow_night.values + [{'start':hour.start,'end':hour.end,'value': hour.value}] %}
                {% endif %}
            {%- endfor -%}
            {% set tonight_min = tonight.values |sort(attribute='value') %}
            {% set tomorrow_min = tomorrow_night.values |sort(attribute='value') %}
            {% set percent_of_tomorrow = ((tonight_min[0].value / tomorrow_min[0].value) * 100) %}
            {% set percent_required = 30 %}
            {{(percent_of_tomorrow - 100 | round (0)) < percent_required}}
          {% else %}
            true
          {% endif %}

      - name: "pricelowertomorrow"
        unique_id: pricelowertomorrow_sensor
        state: >-
          {%-set hour = now().hour | float(default=0)-%}
          {%-set nordpool = states.sensor.nordpool -%}
          {% if nordpool.attributes.tomorrow_valid %}
            {% set today=state_attr('sensor.nordpool', 'raw_today')|sort(attribute='value') %}
            {% set tomorrow=state_attr('sensor.nordpool', 'raw_tomorrow')|sort(attribute='value') %}
            {{today[0].value > tomorrow[0].value}}
          {% else %}
            False
          {% endif %}

      - name: "dyreste_3_timer"
        unique_id: dyreste_3_timer_sensor
        state: >-
          {% set l=state_attr('sensor.nordpool', 'raw_today')|sort(attribute='value') %}
          {{ (now() >= l[23].start and now() <= l[23].end)
          or (now() >= l[22].start and now() <= l[22].end)
          or (now() >= l[21].start and now() <= l[21].end) }}

      - name: "billigste_3_timer"
        unique_id: billigste_3_timer_sensor
        state: >-
          {% set l=state_attr('sensor.nordpool', 'raw_today')|sort(attribute='value') %}
          {{ (now() >= l[0].start and now() <= l[0].end)
          or (now() >= l[1].start and now() <= l[1].end)
          or (now() >= l[2].start and now() <= l[2].end) }}

      - name: "billigste_8_timer"
        unique_id: billigste_8_timer_sensor
        state: >-
          {% set timer=state_attr('sensor.nordpool', 'raw_today')|sort(attribute='value') %}           
          {%set vars = namespace(count= 0, found = false)%}
          {%-for time in timer%}
            {%if vars.count < 8%}
              {%if time.start.hour == now().hour%}
                {%set vars.found = true %}
              {%endif%}
              {%-set vars.count = vars.count+1-%}
            {%endif%}
          {%-endfor%}
          {{vars.found}}

      - name: "islowprice"
        unique_id: islowprice_sensor
        state: >-
          {{states.sensor.priceanalyzer.attributes['low price'] == true}}

      - name: "pricerelativycheap"
        unique_id: pricerelativycheap_sensor
        state: >-
          {%- set price = states.sensor.nordpool -%}
          {{price.state | float(default=0)< price.attributes.peak | float}}

      - name: "pricecorrectiondownnexthour"
        unique_id: pricecorrectiondownnexthour_sensor
        state: >-
          {%-set nordpool = states.sensor.nordpool -%}
          {%-set percentThreshold = ((nordpool.attributes.max / nordpool.attributes.min) - 1) -%}
          {% set percentThreshold = (percentThreshold / 4) + 1 %}
          {%-set hour = now().hour | int(default=0)-%}
          {%-set nordpool = states.sensor.nordpool -%}
          {%-set priceNextHour = (nordpool.attributes.today[hour+1] or nordpool.attributes.tomorrow[0]) | float(default=0)-%}
          {%-set priceNextNextHour = (nordpool.attributes.today[hour + 2] or nordpool.attributes.tomorrow[0]) | float(default=0)-%}
          {% set priceFallingNextNextHour = (priceNextNextHour / priceNextHour) < percentThreshold %}
          {{(priceNextHour | float(default=0)> nordpool.attributes.peak | float) or (priceNextHour == nordpool.attributes.max) or (priceFallingNextNextHour)}}

      - name: "ismaxprice"
        unique_id: ismaxprice_sensor
        state: >-
          {%- set price = states.sensor.nordpool -%}
          {{price.state | float(default=0) == price.attributes.max | float}}

      - name: "pricegaining"
        unique_id: pricegaining_sensor
        state: >-
          {%-set nordpool = states.sensor.nordpool -%}
          {%-set percentThreshold = ((nordpool.attributes.max / nordpool.attributes.min) - 1) -%}
          {% set percentThreshold = (percentThreshold / 4) + 1 %}
          {%-set hour = now().hour | int(default=0)-%}
          {%-set nordpool = states.sensor.nordpool -%}
          {%-set priceNextHour = (nordpool.attributes.today[hour+1] or nordpool.attributes.tomorrow[0]) | float(default=0)-%}
          {%-set priceNextNextHour = (nordpool.attributes.today[hour + 2] or nordpool.attributes.tomorrow[0]) | float(default=0)-%}
          {%-set priceNextNextNextHour = (nordpool.attributes.today[hour + 3] or nordpool.attributes.tomorrow[0]) | float(default=0)-%}
          {%-set priceNextNextNextNextHour = (nordpool.attributes.today[hour + 4] or nordpool.attributes.tomorrow[0]) | float(default=0)-%}
          {%-set priceNow = nordpool.attributes.today[hour] | float(default=0)-%}
          {% set priceGainingNextHour = ((priceNextHour / priceNow)) > percentThreshold  %}
          {% set priceGainingNextNextHour = ((priceNextNextHour / priceNow)) > percentThreshold  %}
          {% set priceGainingNextNextNextHour = ((priceNextNextNextHour / priceNow)) > percentThreshold  %}
          {{priceGainingNextHour or (priceGainingNextNextHour) or (priceGainingNextNextNextHour)}}

      - name: "pricefalling"
        unique_id: pricefalling_sensor
        state: >-
          {%-set nordpool = states.sensor.nordpool -%}
          {%-set percentThreshold = ((nordpool.attributes.min/ nordpool.attributes.max) - 1) -%}
          {% set percentThreshold = (percentThreshold / 4) + 1 %}
          {%-set hour = now().hour | int(default=0)-%}
          {%-set nordpool = states.sensor.nordpool -%}
          {%-set priceNextHour = (nordpool.attributes.today[hour+1] or nordpool.attributes.tomorrow[0]) | float(default=0)-%}
          {%-set priceNextNextHour = (nordpool.attributes.today[hour + 2] or nordpool.attributes.tomorrow[0]) | float(default=0)-%}
          {%-set priceNow = nordpool.attributes.today[hour] | float(default=0)-%}
          {%-set cheap = states.sensor.pricelevel.state != 'EXPENSIVE' and states.sensor.pricelevel.state != 'VERY_EXPENSIVE' -%}
          {% set priceFallingNextHour = (priceNextHour / priceNow) < percentThreshold %}
          {% set priceFallingNextNextHour = (priceNextNextHour / priceNow) < percentThreshold %}
          {% set priceGaining =  states.binary_sensor.pricegaining.state == 'on' %}
          {{(priceFallingNextHour or priceFallingNextNextHour) and priceGaining == false}}

      - name: "hot_water_probably_running"
        unique_id: hot_water_probably_running_sensor
        device_class: power
        delay_off:
          hours: 2
        state: "{{states.switch.bathroom_fan.state == 'on' and states.input_select.alarm.state == 'Disarm'}}"
automation:
  # - alias: NotifySpikeToday
  #   trigger:
  #   - platform: time
  #     at: 06:00:00
  #   action:
  #   - service: script.telegram_notify
  #     data:
  #       message: "Price spike today is {{states.sensor.pricespike.state}}"

  # - alias: 'GarageHeaterOn'
  #   trigger:
  #     - platform: state
  #       entity_id: cover.garage_door
  #       to: 'off'
  #     - platform: state
  #       entity_id: binary_sensor.pricerelativycheap
  #       to: 'on'
  #   action:
  #   - service: climate.turn_on
  #     entity_id: climate.garage_heater

  # - alias: 'GarageHeaterOff'
  #   trigger:
  #     - platform: state
  #       entity_id: cover.garage_door
  #       to: 'on'
  #     - platform: state
  #       entity_id: binary_sensor.pricerelativycheap
  #       to: 'off'
  #   action:
  #   - service: climate.turn_off
  #     entity_id: climate.garage_heater

  # - alias: 'adjustGarageTemp'
  #   trigger:
  #     - platform: state
  #       entity_id: sensor.pricecorrection
  #     - platform: state
  #       entity_id: input_number.garagetemp
  #     - platform: state
  #       entity_id: input_number.garagetemp
  #   action:
  #     - service: climate.set_temperature
  #       data_template:
  #         entity_id: climate.garage_heater
  #         temperature: '{{ [states.input_number.garagetemp.state | float(default=0)+ [((states.sensor.pricecorrection.state | float(default=0) * 5)), 1] | max, 0] | min }}'

  - id: adjustsokkeltemp
    alias: Climate Sokkel - Adjust temp
    mode: restart
    trigger:
      - platform: homeassistant
        event: start
      - platform: state
        entity_id:
          - sensor.sokkeltemp
          - sensor.priceanalyzer
    action:
      - service: climate.set_temperature
        data_template:
          entity_id: climate.sokkel
          temperature: >-
            {%-set baseTemp = states.input_number.sokkeltemp.state | float(default=0)%}
            {%-set priceanalyzer = states.sensor.pricecorrection.state | float(default=0)%}
            {{baseTemp + priceanalyzer}}

  - id: adjustbathroomtemp
    alias: Climate bathroom - Adjust temp
    mode: restart
    trigger:
      - platform: homeassistant
        event: start
      - platform: state
        entity_id:
          - sensor.bathroomtemp
    action:
      - service: climate.set_temperature
        data_template:
          entity_id: climate.bathroom
          temperature: "{{ states.sensor.bathroomtemp.state | int(default=0) }}"

  - id: adjustvindfangtemp
    alias: Climate Vindfang - Adjust temp
    mode: restart
    trigger:
      - platform: homeassistant
        event: start
      - platform: state
        entity_id:
          - sensor.vindfangtemp
    action:
      - service: climate.set_temperature
        data_template:
          entity_id: climate.vindfang
          temperature: "{{ states.sensor.vindfangtemp.state | int(default=0) }}"

  # - id: turnOffEaseeWhenHighPrice
  #   alias: turnOffEaseeWhenHighPrice
  #   trigger:
  #     - platform: state
  #       entity_id: sensor.pricecorrection
  #   action:
  #     - service: "switch.turn_{{iif(states('sensor.pricecorrection') | float < 0,'off','on')}}"
  #       entity_id: switch.garage_is_enabled

  - id: adjusttemp
    alias: Climate Stua - Adjust temp
    mode: restart
    trigger:
      - platform: homeassistant
        event: start
      - platform: state
        entity_id: sensor.tempsenttoheater, input_select.operationmode
    condition:
      condition: and
      conditions:
        # - condition: state
        #   entity_id: input_select.operationmode
        #   state: Heat
        - condition: state
          entity_id: input_boolean.warmupmorning
          state: "off"
        - condition: numeric_state
          entity_id: sensor.tempsenttoheater
          above: 15
    action:
      # - service: climate.set_hvac_mode
      #   data_template:
      #     entity_id: climate.toilet_heater
      #     hvac_mode: "heat"
      - service: climate.set_hvac_mode
        data_template:
          entity_id: climate.varmepumpe
          hvac_mode: "{{states.input_select.operationmode.state}}"
      - service: climate.set_temperature
        data_template:
          entity_id: climate.varmepumpe
          temperature: "{{ states.sensor.tempsenttoheater.state | int(default=0) }}"
      # - service: climate.set_temperature
      #   data_template:
      #     entity_id: climate.stua_heater
      #     temperature: "{{ states.sensor.baseheat.state | int(default=0) - 1 }}"
      # - service: climate.set_temperature
      #   data_template:
      #     entity_id: climate.stua_heater
      #     temperature: "{{ (states.sensor.baseheat.state | float) - 2}}"

  - alias: heatpumpadjustswingmode
    id: heatpumpadjustswingmode
    trigger:
      - platform: state
        entity_id: media_player.tv_stua
        to: "on"
        for:
          seconds: 10
      - platform: state
        entity_id: media_player.tv_stua
        to: "off"
        for:
          seconds: 10
      # - platform: state
      #   entity_id: climate.varmepumpe
      - platform: state
        entity_id: input_select.heat_pump_swing_mode
    action:
      - service: climate.set_swing_mode
        entity_id: climate.varmepumpe
        data:
          swing_mode: >-
            {% set mode = states('input_select.heat_pump_swing_mode')%}
            {%if mode == 'auto_tv'%}
              {%if states.media_player.tv_stua.state == 'on'%}
                      5_down
              {%else%}
                      auto
              {%endif%}
            {%else%}
              {{mode}}
            {%endif%}

  - alias: TurnOffClimateStua
    trigger:
      - platform: numeric_state
        entity_id: sensor.tempsenttoheater
        below: 16
      - platform: numeric_state
        entity_id: sensor.tempsenttoheater
        below: 16
        for:
          minutes: 3
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.warmupmorning
          state: "off"
    action:
      - service: climate.turn_off
        data_template:
          entity_id:
            - climate.varmepumpe
            # - climate.toilet_heater
            #- climate.stua_heater
      - service: script.turn_on
        entity_id: script.turnoffheaters

  # - id: adjustfan
  #   alias: Climate Stua - Adjust fan
  #   trigger:
  #   - platform: state
  #     entity_id: sensor.fanmode
  #   - platform: state
  #     entity_id: climate.varmepumpe
  #   - platform: state
  #     entity_id: sensor.tempsenttoheater
  #   condition:
  #     condition: and
  #     conditions:
  #     # - condition: state
  #     #   entity_id: input_select.operationmode
  #     #   state: Heat
  #       - condition: state
  #         entity_id: input_boolean.warmupmorning
  #         state: 'off'
  #       # - condition: numeric_state
  #       #   entity_id: sensor.tempsenttoheater
  #       #   above: 15
  #   action:
  #   - service: climate.set_fan_mode
  #     data_template:
  #       entity_id: climate.varmepumpe
  #       fan_mode: '{{states.sensor.fanmode.state}}'

  - alias: Toggle Office Heater
    mode: single
    max_exceeded: silent
    trigger:
      - platform: state
        entity_id: binary_sensor.motionoffice
      # - platform: state
      #   entity_id: binary_sensor.motion_downstairs_office
    action:
      - service: >
          {% if states('binary_sensor.motionoffice') == 'on'
            and states('sensor.pricecorrection') | float > -1 %}
            climate.turn_on
          {% else %}
            climate.turn_off
          {% endif %}
        entity_id: climate.office_heater

  #This will also turn off heaters if heat pump is turned off manually. No need to run only them.
  #Watch out if you implement some manual climate logic, men this will probably just help.
  #Also turn off when hjemmetemp is reached?
  - id: turnOffHeatersWhenPumpOff
    alias: Climate - obey heatpump
    trigger:
      - platform: state
        entity_id: climate.varmepumpe
        to: "off"
      - platform: state
        entity_id: climate.varmepumpe
        to: "auto"
      - platform: state
        entity_id: climate.varmepumpe
        to: "cool"
      - platform: state
        entity_id: climate.varmepumpe
        to: "fan"
    action:
      - service: script.turn_on
        entity_id: script.turnoffheaters
        # TODO turn on heaters when on?

  - alias: WarmupMorningExtraCold
    id: WarmupmorningExtraCold
    trigger:
      - platform: time
        at: "04:30:00"
    condition:
      condition: and
      conditions:
        #group.people problem
        - condition: state
          entity_id: group.people
          state: "home"
          # if the temperature is under the threshold, for example -5 degrees.
        - condition: template
          value_template: "{{ float(states.sensor.ute_temperature.state) < (float(states.input_number.coldthreshold.state)) }}"
          # If the task it to warm up more than 1 degree.
      # - condition: template
      #   value_template: "{{ float(states.sensor.stua_temperature.state) < (float(states.input_number.hjemmetemp.state) - 1) }}"
    action:
      - service: script.turn_on
        entity_id: script.warmupmorning

  - alias: WarmupMorningExtraExtraCold2
    id: WarmupmorningExtraExtraCold2
    trigger:
      - platform: time
        at: "04:00:00"
    condition:
      condition: and
      conditions:
        #group.people problem
        - condition: state
          entity_id: group.people
          state: "home"
        - condition: numeric_state
          entity_id: sensor.ute_temperature
          below: -8
      # - condition: template
      #   value_template: "{{ float(states.sensor.stua_temperature.state) < (float(states.input_number.hjemmetemp.state) - 2) }}"
    action:
      - service: script.turn_on
        entity_id: script.warmupmorning

  - id: endWarmupMorning
    alias: EndWarmupUp
    trigger:
      - platform: template
        value_template: "{{(states.sensor.stua_temperature.state >= states.input_number.hjemmetemp.state) and is_state('input_boolean.warmupmorning', 'on')}}"
      - platform: state
        entity_id: input_select.alarm
        to: "Arm Home"
      - platform: state
        entity_id: input_select.alarm
        to: "Arm Away"
    # condition:
    #   - condition: template
    #     value_template: "{{(states.sensor.stua_temperature.state >= states.input_number.hjemmetemp.state) and is_state('input_boolean.warmupmorning', 'on')}}"
    action:
      - service: input_boolean.turn_off
        entity_id: input_boolean.warmupmorning
      - service: climate.set_temperature
        data_template:
          entity_id: climate.varmepumpe
          temperature: "{{ states.sensor.tempsenttoheater.state | float(default=22)}}"
      - service: climate.set_hvac_mode
        data_template:
          entity_id: climate.varmepumpe
          hvac_mode: "{{ states.input_select.operationmode.state}}"
      - condition: template
        value_template: "{{ states.input_select.operationmode.state == 'heat'}}"
      # - service: climate.set_hvac_mode
      #   data_template:
      #     entity_id: climate.stua_heater
      #     hvac_mode: "heat"

  - alias: WarmupMorning
    trigger:
      - platform: time
        at: "05:00:00"
      - platform: time
        at: "05:20:00"
    condition:
      # If we want heating when home, and we are home, and it's less than 21 inside and 10 outside.
      condition: and
      conditions:
        # If we want heating when home.
        - condition: numeric_state
          entity_id: input_number.hjemmetemp
          above: 15
          # If the current temp(at 0500) is less than 21
        - condition: template
          value_template: "{{states.climate.varmepumpe.attributes.current_temperature < 21}}"
          #condition for (hjemmetemp - actual temp) > 2 degrees?
          # WIll only start heating if big difference, until there is no difference.
        #group.people problem
        - condition: state
          entity_id: group.people
          state: "home"
        # - condition: template
        #   value_template: "{{ float(states.sensor.stua_temperature.state) < (float(states.input_number.hjemmetemp.state))-0.5 }}"
        #If ít's colder than 10. So, not do this in the summer.
        - condition: numeric_state
          entity_id: sensor.ute_temperature
          below: 10
    action:
      - service: script.turn_on
        entity_id: script.warmupmorning
      - service: script.telegram_notify
        data:
          message: "Warmup morning started. Temp is {{states.climate.varmepumpe.attributes.current_temperature}}"

  # - alias: "TrymHeaterOn"
  #   trigger:
  #     - platform: state
  #       entity_id: binary_sensor.trym_window
  #       to: "off"
  #   action:
  #     - service: climate.turn_on
  #       entity_id: climate.trym

  # - alias: "TrymHeaterOff"
  #   trigger:
  #     - platform: state
  #       entity_id: binary_sensor.trym_window
  #       to: "on"
  #   action:
  #     - service: climate.turn_off
  #       entity_id: climate.trym

  - id: TurnOffHeaters
    alias: TurnOffHeaters
    trigger:
      - platform: state
        entity_id: input_number.bortetemp
      - platform: state
        entity_id: input_select.alarm
        to: "Arm Away"
        # for:
        #    minutes: 4
      - platform: state
        entity_id: input_select.alarm
        to: "Arm Home"
        # for:
        #    minutes: 4
    condition:
      condition: or
      conditions:
        - condition: state
          entity_id: input_select.alarm
          state: "Arm Away"
        - condition: state
          entity_id: input_select.alarm
          state: "Arm Home"
    action:
      - service: script.turn_on
        entity_id: script.turnoffheaters

  - alias: TrymTemp
    trigger:
      - platform: state
        entity_id: sensor.trymtemp
    action:
      - service: climate.set_temperature
        entity_id: climate.trym
        data_template:
          temperature: "{{states.sensor.trymtemp.state | float(default=13)}}"
# - alias: WarmupMorningWeekend
#   id: WarmupmorningWeekend
#   trigger:
#   - platform: time
#     at: '06:50:00'
#   condition:
#     condition: and
#     conditions:
#     - condition: time
#       weekday:
#       - sat
#       - sun
#     - condition: state
#       entity_id: group.people
#       state: 'home'
#     - condition: numeric_state
#       entity_id: sensor.ute_temperature
#       below: 10
#       #Temperature is 2 degrees lower than target
#     # - condition: template
#     #   value_template: "{{ float(states.sensor.stua_temperature.state) < (float(states.sensor.tempsenttoheater.state) - 2) }}"
#   action:
#   - service: climate.set_temperature
#     data_template:
#       entity_id: climate.varmepumpe
#       temperature: 28
#       #temperature: '{{ float(states.sensor.tempsenttoheater.state) | int(default=0) + 3 }}'
#       #temperature: '{{ states.input_number.hjemmetemp.state | int(default=0) }}'
#   - delay:
#       minutes: 120
#   - service: climate.set_temperature
#     data_template:
#       entity_id: climate.varmepumpe
#       temperature: '{{ float(states.sensor.tempsenttoheater.state)}}'

script:
  warmupcominghome:
    alias: Warmup Coming Home
    sequence:
      - condition: template
        value_template: "{{ false }}" #Plombert
      - condition: template
        value_template: "{{ states.input_select.alarm.state != 'Disarm' }}"
      # If we want heating when home.
      - condition: numeric_state
        entity_id: input_number.hjemmetemp
        above: 15
      - condition: numeric_state
        entity_id: sensor.ute_temperature
        below: 10
      - condition: state
        entity_id: input_select.operationmode
        state: "heat"
      - condition: template
        value_template: "{{(states.climate.varmepumpe.attributes.current_temperature | int(default=0)) < (states.input_number.hjemmetemp.state | int(default=0))}}"
      - service: script.telegram_notify
        data_template:
          message: "Warmup started. Temp is {{states.climate.varmepumpe.attributes.current_temperature}}"
      - service: climate.set_hvac_mode
        data_template:
          entity_id: climate.varmepumpe
          hvac_mode: "heat"
      - service: climate.set_temperature
        data_template:
          entity_id: climate.varmepumpe
          temperature: 28
      - service: climate.set_hvac_mode
        data_template:
          entity_id: climate.varmepumpe
          hvac_mode: "high"
      # - service: climate.set_hvac_mode
      #   data_template:
      #     entity_id: climate.toilet_heater
      #     hvac_mode: "heat"
      # - service: climate.set_temperature
      #   data_template:
      #     entity_id: climate.toilet_heater
      #     temperature: "{{ states.input_number.hjemmetemp.state | int(default=0)}}"
      - wait_template: "{{(states.sensor.stua_temperature.state > states.input_number.hjemmetemp.state) or (states.input_select.alarm.state == 'Disarm')}}"
        timeout: "0:45:00"
      - service: climate.set_hvac_mode
        data_template:
          entity_id: climate.varmepumpe
          hvac_mode: "heat"
      - service: climate.set_temperature
        data_template:
          entity_id: climate.varmepumpe
          temperature: "{{ float(states.input_number.bortetemp.state)}}"
      - service: climate.set_hvac_mode
        data_template:
          entity_id: climate.varmepumpe
          hvac_mode: "{{ states.input_select.operationmode.state}}"
  #TODO: Set tempsenttoheater instead of bortetemp(or just run automation), but override this if something indicates that we are not coming home.

  warmupmorning:
    alias: Warmup Morning
    sequence:
      - condition: template
        value_template: "{{ false }}" #Plombert
      - service: climate.set_hvac_mode
        data_template:
          entity_id: climate.varmepumpe
          hvac_mode: "heat"
      - service: input_boolean.turn_on
        entity_id: input_boolean.warmupmorning
      - service: climate.set_fan_mode
        data_template:
          entity_id: climate.varmepumpe
          fan_mode: "high"
      - service: climate.set_temperature
        data_template:
          entity_id: climate.varmepumpe
          temperature: 28
      # - service: climate.set_hvac_mode
      #   data_template:
      #     entity_id: climate.toilet_heater
      #     hvac_mode: "heat"
      # - service: climate.set_temperature
      #   data_template:
      #     entity_id: climate.toilet_heater
      #     temperature: "{{ states.input_number.hjemmetemp.state | int(default=0)}}"
      - wait_template: "{{ states.sensor.stua_temperature.state > states.input_number.hjemmetemp.state}}"
        timeout: "1:00:00"
      # - service: climate.set_hvac_mode
      #   data_template:
      #     entity_id: climate.varmepumpe
      #     hvac_mode: 'heat'
      - service: climate.set_temperature
        data_template:
          entity_id: climate.varmepumpe
          temperature: >-
            {%-set priceGaining = states.binary_sensor.pricegaining.state == 'on' -%}
            {%-set uteTemp = states.sensor.ute_temperature.state | float(default=0)or states.sensor.netatmo_home_temperature.state | float(default=0) -%}
            {%-set temp = float(states.input_number.hjemmetemp.state) -%}
            {%-set prettyCold = float(uteTemp) < float(states.input_number.coldthreshold.state) -%}
            {% if prettyCold %} 
              {%-set temp = temp + float(states.input_number.extradegrees.state) -%}
            {% endif %}
            {% if priceGaining and temp > 15 %}
                {%-set temp = temp + 1 -%}
            {% endif %}
            {{temp}}
      - service: input_boolean.turn_off
        entity_id: input_boolean.warmupmorning
      # - service: climate.set_hvac_mode
      #   data:
      #     entity_id: climate.stua_heater
      #     hvac_mode: "heat"

  turnoffheaters:
    alias: Turn Off Heaters
    sequence:
      #Millsmart
    # - service: climate.turn_off
    #   data_template:
    #     entity_id: climate.stua_heater
    # - service: switch.turn_off
    #   entity_id: switch.kitchen_heater
    #   #toilet
    # - service: switch.turn_off
    #   entity_id: switch.bench
input_number:
  sokkeltemp:
    name: Sokkel Temperatur
    min: 5
    max: 30
    step: 1
    mode: slider

  vindfangtemp:
    name: Vindfang Temperatur
    min: 5
    max: 30
    step: 1
    mode: slider

  bathroomtemp:
    name: Bathroom Temperatur
    min: 5
    max: 30
    step: 1
    mode: slider

  hjemmetemp:
    name: Hjemmetemperatur
    ##initial: 22
    min: 12
    max: 30
    step: 1
    mode: slider

  bortetemp:
    name: Bortetemperatur
    ##initial: 20
    min: 12
    max: 30
    step: 1
    mode: slider

  nattatemp:
    name: Nattatemperatur
    ##initial: 20
    min: 12
    max: 30
    step: 1
    mode: slider

  temperature:
    name: Temperature
    ##initial: 22
    min: 12
    max: 30
    step: 1

  extradegrees:
    name: Extra Degrees to heat when cold
    ##initial: 22
    min: 0
    max: 10
    step: 1

  coldthreshold:
    name: Threshold for extra degrees
    ##initial: 22
    min: -20
    max: 10
    step: 1

  garagetemp:
    name: "Garage temperature"
    min: -10
    max: 20
    step: 0.5

  tyra_temp:
    name: "Tyra Temperature"
    min: 0
    max: 25
    step: 1

  trym_temp:
    name: "Trym Temperature"
    min: 0
    max: 25
    step: 1
