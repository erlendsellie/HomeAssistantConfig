tibber_data_package:
  #custom component for additional data from tibber
  # https://github.com/Danielhiversen/home_assistant_tibber_data
  tibber_data:
  #    email: !secret tibber_email
  #   password: !secret tibber_password

  template:
    - sensor:
        - name: "Subsidy"
          unit_of_measurement: "NOK"
          state: >-
            {%set subsidy = max(states('sensor.estimated_subsidy_sivert_thonstads_vei_6')| float,0) %}
            {{subsidy | round(2)}}
        - name: "Subsidy Ã˜re"
          unit_of_measurement: "NOK"
          state: >-
            {%set subsidy = max(states('sensor.subsidy')| float,0) %}
            {{subsidy * 100| round(2)}}
        - name: "Customer Price With Subsidy"
          unit_of_measurement: "NOK"
          state: >-
            {%set base_price = states('sensor.monthly_avg_customer_price_sivert_thonstads_vei_6') | float%}
            {%set subsidy = states('sensor.subsidy')| float %}
            {{(base_price - subsidy) | round(2)}}
        - name: "Price With Subsidy"
          unit_of_measurement: "NOK"
          state: >-
            {%set base_price = states('sensor.monthly_avg_price_sivert_thonstads_vei_6') | float%}
            {%set subsidy = states('sensor.subsidy') | float%}
            {{(base_price - subsidy) | round(2)}}
        - name: "Price Now With Subsidy"
          unit_of_measurement: "NOK"
          state: >-
            {%set base_price = states('sensor.nordpool') | float%}
            {%set subsidy = states('sensor.subsidy') | float%}
            {{(base_price - subsidy) | round(2)}}
        - name: "Customer Monthly Cost With Subsidy"
          unit_of_measurement: "NOK"
          state: >-
            {%set price = states('sensor.customer_price_with_subsidy') | float%}
            {%set kwh = states('sensor.monthly_net_consumption_sivert_thonstads_vei_6b') | float %}
            {{(kwh * price) | round(2)}}
        - name: "Monthly Cost With Subsidy"
          unit_of_measurement: "NOK"
          state: >-
            {%set price = states('sensor.price_with_subsidy') | float%}
            {%set kwh = states('sensor.monthly_net_consumption_sivert_thonstads_vei_6b') | float%}
            {{(kwh * price) | round(2)}}
        - name: "Monthly Saving Compared to Nordpool Average"
          unit_of_measurement: "NOK"
          state: >-
            {%set nordpool_average_cost = states('sensor.monthly_cost_with_subsidy') | float%}
            {%set customer_cost = states('sensor.customer_monthly_cost_with_subsidy') | float%}
            {{(nordpool_average_cost - customer_cost) | round(2)}}
        - name: "Customer Daily Average"
          unit_of_measurement: "NOK"
          state: >-
            {{ (states('sensor.accumulated_cost_sivert_thonstads_vei_6b')|float(default=2) / states('sensor.accumulated_consumption_sivert_thonstads_vei_6b')|float(default=2)) | round (2)}}
        - name: "Nordpool Daily Average"
          unit_of_measurement: "NOK"
          state: >-
            {{state_attr('sensor.nordpool','average') | round (2)}}
        - name: "Saved Today Compared to Nordpool Average"
          unit_of_measurement: "NOK"
          state: >-
            {%set mitt_snitt = states('sensor.customer_daily_average') | float(default=0) %}
            {%set snitt = states('sensor.nordpool_daily_average') | float(default=0) %}
            {%set forbruk = states('sensor.accumulated_consumption_sivert_thonstads_vei_6b')|float(default=0) %}
            {{((snitt * forbruk) - (mitt_snitt * forbruk)) | round(2)}}
