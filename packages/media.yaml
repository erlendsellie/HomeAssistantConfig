template:
  - sensor:
      - name: "tvsource"
        unique_id: tvsource_sensor
        state: >-
          {% if is_state('media_player.tv_stua', 'unavailable') or is_state('media_player.tv_stua', 'unknown') %}
            off
          {% else %}
            {{ state_attr("media_player.tv_stua", "source") | default("off") }}
          {% endif %}

      - name: "speakervolume"
        unique_id: speakervolume_sensor
        unit_of_measurement: "%"
        state: >-
          {%-set trymasleep = states.input_boolean.trymasleep.state == 'on' -%}
          {%-set tyraasleep = states.input_boolean.tyraasleep.state == 'on' -%}
          {% if trymasleep or tyraasleep %}
            0.5
          {% elif states.input_boolean.powernap.state == 'on' %} 
            0.0
          {% elif states.input_select.alarm.state == 'Disarm' %} 
            0.6
          {% elif states.input_select.alarm.state == 'Arm Home'%}
            0.1
          {% else %}
            0.0
          {% endif %}

  - binary_sensor:
      - name: "tv_on"
        unique_id: tv_on_sensor
        state: "{{ states.media_player.tv_stua.state == 'Playing' }}"

      - name: "bed_tv_idle"
        unique_id: bed_tv_idle_sensor
        delay_on:
          minutes: 30
        state: >-
          {{ (states.media_player.bedroom_tv.state == 'idle' or 
          states.media_player.bedroom_tv.state == 'paused' or 
          states.media_player.bedroom_tv.state == 'off')
          and states.media_player.tv_soverommet.state == 'on' }}

      - name: "bedtvon"
        unique_id: bedtvon_sensor
        delay_off:
          minutes: 2
        state: "{{ states.media_player.bedroom_tv.state != 'off' }}"

script:
  pause_play_all:
    alias: Pause/Play All Media Players
    sequence:
      - service: media_player.media_play_pause
        target:
          entity_id: "{{ states.media_player | selectattr('state', 'in', ['playing', 'paused']) | map(attribute='entity_id') | list }}"
  