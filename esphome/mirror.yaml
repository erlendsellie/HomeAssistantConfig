esphome:
  name: mirror
  friendly_name: Mirror
  includes:
    - ingics_parser.h

esp32:
  board: esp32dev
  framework:
    type: esp-idf   # Riktig for BT-proxy

# Viktig: ikke bruk web_server samtidig (minneproblemer)

logger:
api:
  encryption:
    key: !secret api_key_mirror

ota:
  - platform: esphome
    password: !secret ota_password_mirror

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password
  ap:
    ssid: "Mirror Fallback Hotspot"
    password: !secret wifi_password
  # (valgfritt) ofte mer stabilt for BT-proxy:
  power_save_mode: none

# BLE Proxy (aktiv er nå default)
bluetooth_proxy:
  active: true

# BLE Scanner – bruk standardverdiene på Wi-Fi
esp32_ble_tracker:
  on_ble_advertise:
    - then:
        lambda: |-
          std::string mac = x.address_str();
          if (mac == "84:72:93:A1:55:4C") {
            if (auto temp = parse_ingics_temp_full(x, "outside")) {
              id(outside_temp).publish_state(temp->internal);
              if (temp->has_probe) {
                id(outside_probe_temp).publish_state(temp->probe);
              }
            }
          }

captive_portal:

sensor:
  - platform: template
    id: outside_temp
    name: "Outside Temp"
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1

  - platform: template
    id: outside_probe_temp
    name: "Outside Probe Temp"
    unit_of_measurement: "°C"
    device_class: temperature
    state_class: measurement
    accuracy_decimals: 1
